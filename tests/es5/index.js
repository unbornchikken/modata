"use strict";
var fs = require("fs");
var mongoose = require("mongoose");
var Schema = mongoose.Schema;
var assert = require("chai").assert;
var Query = require("../../").Query;
var ObjectId = Schema.ObjectId;
var OrigSchema = new mongoose.Schema({value: {
    type: String,
    default: "original"
  }});
var TestSchema = new mongoose.Schema({
  title: {
    type: String,
    index: true
  },
  msg: {
    type: String,
    lowercase: true,
    trim: true
  },
  date: {
    type: Date,
    default: Date.now
  },
  orig: {
    type: ObjectId,
    ref: "originals"
  },
  nest: {ed: {
      type: String,
      default: "value"
    }}
});
TestSchema.plugin(Query);
var origModel = mongoose.model("originals", OrigSchema);
var Test = mongoose.model("test", TestSchema);
mongoose.connect(process.env.MONGO_URL, {});
var _id = "123123";
describe('Query:basic', function() {
  before(function(done) {
    this.timeout(10000);
    var create = function(i, max, callback) {
      if (i < max) {
        var obj = new Test({
          title: (i < 10 ? 'testa' : 'testb'),
          msg: 'i#' + i,
          orig: _id
        });
        obj.save(function(error, doc) {
          create(i + 1, max, callback);
        });
      } else {
        callback();
      }
    };
    mongoose.connection.on('connected', function() {
      origModel.remove({}, function() {
        var obj = new origModel();
        obj.save(function(error, doc) {
          _id = doc._id;
          Test.remove({}, function() {
            create(0, 20, done);
          });
        });
      });
    });
  });
  it('all', function(done) {
    Test.Query({q: '{}'}).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 20);
      assert.isTrue((data[0].orig + '').match(/([0-9a-z]{24})/) != null);
      done();
    });
  });
  it('regex', function(done) {
    Test.Query({q: '{"title": {"$regex": "/^testa/"}}'}).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 10);
      assert.isTrue((data[0].orig + '').match(/([0-9a-z]{24})/) != null);
      done();
    });
  });
  it('regex && ic', function(done) {
    Test.Query({
      q: '{"title": {"$regex": "/^testa/"}}',
      ic: true,
      sk: 2
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.count, 10);
      assert.equal(data.data.length, 8);
      assert.isTrue((data.data[0].orig + '').match(/([0-9a-z]{24})/) != null);
      done();
    });
  });
  it('find & sort', function(done) {
    Test.Query({
      q: '{}',
      t: 'find',
      s: '{"msg": 1}',
      l: 1
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.typeOf(data, 'Array');
      assert.equal(data[0].title, 'testa');
      assert.equal(data[0].msg, 'i#0');
      assert.equal(data.length, 1);
      done();
    });
  });
  it('exact', function(done) {
    Test.Query({q: '{"msg":"i#3"}'}).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 1);
      assert.equal(data[0].msg, "i#3");
      done();
    });
  });
  it('populate', function(done) {
    Test.Query({
      q: '{"msg":"i#3"}',
      p: 'orig'
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 1);
      assert.equal(data[0].msg, "i#3");
      assert.equal(data[0].orig.value, "original");
      done();
    });
  });
  it('limit & select', function(done) {
    Test.Query({
      q: '{}',
      f: 'title',
      l: '3',
      s: '{"title": -1}'
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 3);
      assert.equal(data[0].msg, undefined);
      assert.equal(data[0].title, "testb");
      assert.equal(data[1].msg, undefined);
      assert.equal(data[1].title, "testb");
      assert.equal(data[2].msg, undefined);
      assert.equal(data[2].title, "testb");
      done();
    });
  });
  it('skip', function(done) {
    Test.Query({
      q: '{}',
      sk: '3'
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 17);
      done();
    });
  });
  it('count', function(done) {
    Test.Query({
      q: '{"$or": [ {"msg":"i#1"}, {"msg":"i#2"}]}',
      t: 'count'
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data, 2);
      done();
    });
  });
  it('distinct', function(done) {
    Test.Query({
      f: 'title',
      t: 'distinct'
    }).exec(function(error, data) {
      assert.equal(error, undefined);
      assert.equal(data.length, 2);
      done();
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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R0FBQyxDQUFDLENBQUM7QUFDN0IsU0FBRyxBQUFDLEVBQUMsQ0FBQztJQUNWLENBQUMsQ0FBQztFQUNOLENBQUMsQ0FBQztBQUVGLEdBQUMsQUFBQyxDQUFDLE9BQU0sQ0FBRyxVQUFVLElBQUcsQ0FBRztBQUN4QixPQUFHLE1BQU0sQUFBQyxDQUFDO0FBQUUsTUFBQSxDQUFHLDJDQUF5QztBQUFHLE1BQUEsQ0FBRyxRQUFNO0FBQUEsSUFBRSxDQUFDLEtBQUssQUFBQyxDQUFDLFNBQVUsS0FBSSxDQUFHLENBQUEsSUFBRyxDQUFHO0FBQ2xHLFdBQUssTUFBTSxBQUFDLENBQUMsS0FBSSxDQUFHLFVBQVEsQ0FBQyxDQUFDO0FBQzlCLFdBQUssTUFBTSxBQUFDLENBQUMsSUFBRyxDQUFHLEVBQUEsQ0FBQyxDQUFDO0FBQ3JCLFNBQUcsQUFBQyxFQUFDLENBQUM7SUFDVixDQUFDLENBQUM7RUFDTixDQUFDLENBQUM7QUFFRixHQUFDLEFBQUMsQ0FBQyxVQUFTLENBQUcsVUFBVSxJQUFHLENBQUc7QUFDM0IsT0FBRyxNQUFNLEFBQUMsQ0FBQztBQUFFLE1BQUEsQ0FBRyxRQUFNO0FBQUcsTUFBQSxDQUFHLFdBQVM7QUFBQSxJQUFFLENBQUMsS0FBSyxBQUFDLENBQUMsU0FBVSxLQUFJLENBQUcsQ0FBQSxJQUFHLENBQUc7QUFDbEUsV0FBSyxNQUFNLEFBQUMsQ0FBQyxLQUFJLENBQUcsVUFBUSxDQUFDLENBQUM7QUFDOUIsV0FBSyxNQUFNLEFBQUMsQ0FBQyxJQUFHLE9BQU8sQ0FBRyxFQUFBLENBQUMsQ0FBQztBQUU1QixTQUFHLEFBQUMsRUFBQyxDQUFDO0lBQ1YsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQUEiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoidGVzdHMvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8qZ2xvYmFsIGl0LGRlc2NyaWJlLGJlZm9yZSovXHJcbmxldCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcclxubGV0IG1vbmdvb3NlID0gcmVxdWlyZShcIm1vbmdvb3NlXCIpO1xyXG5sZXQgU2NoZW1hID0gbW9uZ29vc2UuU2NoZW1hO1xyXG5sZXQgYXNzZXJ0ID0gcmVxdWlyZShcImNoYWlcIikuYXNzZXJ0O1xyXG5sZXQgUXVlcnkgPSByZXF1aXJlKFwiLi4vLi4vXCIpLlF1ZXJ5O1xyXG5cclxubGV0IE9iamVjdElkID0gU2NoZW1hLk9iamVjdElkO1xyXG5cclxubGV0IE9yaWdTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcclxuICAgIHZhbHVlOiB7IHR5cGU6IFN0cmluZywgZGVmYXVsdDogXCJvcmlnaW5hbFwiIH1cclxufSk7XHJcbmxldCBUZXN0U2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgICB0aXRsZTogeyB0eXBlOiBTdHJpbmcsIGluZGV4OiB0cnVlIH0sXHJcbiAgICBtc2c6IHsgdHlwZTogU3RyaW5nLCBsb3dlcmNhc2U6IHRydWUsIHRyaW06IHRydWUgfSxcclxuICAgIGRhdGU6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogRGF0ZS5ub3cgfSxcclxuICAgIG9yaWc6IHsgdHlwZTogT2JqZWN0SWQsIHJlZjogXCJvcmlnaW5hbHNcIiB9LFxyXG4gICAgbmVzdDoge1xyXG4gICAgICAgIGVkOiB7IHR5cGU6IFN0cmluZywgZGVmYXVsdDogXCJ2YWx1ZVwiIH1cclxuICAgIH1cclxufSk7XHJcblRlc3RTY2hlbWEucGx1Z2luKFF1ZXJ5KTtcclxubGV0IG9yaWdNb2RlbCA9IG1vbmdvb3NlLm1vZGVsKFwib3JpZ2luYWxzXCIsIE9yaWdTY2hlbWEpO1xyXG5sZXQgVGVzdCA9IG1vbmdvb3NlLm1vZGVsKFwidGVzdFwiLCBUZXN0U2NoZW1hKTtcclxuXHJcblxyXG5tb25nb29zZS5jb25uZWN0KHByb2Nlc3MuZW52Lk1PTkdPX1VSTCwge30pO1xyXG5sZXQgX2lkID0gXCIxMjMxMjNcIjtcclxuXHJcbmRlc2NyaWJlKCdRdWVyeTpiYXNpYycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGJlZm9yZShmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIHRoaXMudGltZW91dCgxMDAwMCk7XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGUgPSBmdW5jdGlvbiAoaSwgbWF4LCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAoaSA8IG1heCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IG5ldyBUZXN0KHsgdGl0bGU6IChpIDwgMTAgPyAndGVzdGEnIDogJ3Rlc3RiJyksIG1zZzogJ2kjJyArIGksIG9yaWc6IF9pZCB9KTtcclxuICAgICAgICAgICAgICAgIG9iai5zYXZlKGZ1bmN0aW9uIChlcnJvciwgZG9jKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlKGkgKyAxLCBtYXgsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdjb25uZWN0ZWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG9yaWdNb2RlbC5yZW1vdmUoe30sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvYmogPSBuZXcgb3JpZ01vZGVsKCk7XHJcbiAgICAgICAgICAgICAgICBvYmouc2F2ZShmdW5jdGlvbiAoZXJyb3IsIGRvYykge1xyXG4gICAgICAgICAgICAgICAgICAgIF9pZCA9IGRvYy5faWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFRlc3QucmVtb3ZlKHt9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZSgwLCAyMCwgZG9uZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnYWxsJywgZnVuY3Rpb24gKGRvbmUpIHtcclxuICAgICAgICBUZXN0LlF1ZXJ5KHsgcTogJ3t9JyB9KS5leGVjKGZ1bmN0aW9uIChlcnJvciwgZGF0YSkge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZXJyb3IsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhLmxlbmd0aCwgMjApO1xyXG4gICAgICAgICAgICBhc3NlcnQuaXNUcnVlKChkYXRhWzBdLm9yaWcgKyAnJykubWF0Y2goLyhbMC05YS16XXsyNH0pLykgIT0gbnVsbCk7XHJcbiAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgaXQoJ3JlZ2V4JywgZnVuY3Rpb24gKGRvbmUpIHtcclxuICAgICAgICBUZXN0LlF1ZXJ5KHsgcTogJ3tcInRpdGxlXCI6IHtcIiRyZWdleFwiOiBcIi9edGVzdGEvXCJ9fScgfSkuZXhlYyhmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGVycm9yLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YS5sZW5ndGgsIDEwKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmlzVHJ1ZSgoZGF0YVswXS5vcmlnICsgJycpLm1hdGNoKC8oWzAtOWEtel17MjR9KS8pICE9IG51bGwpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIGl0KCdyZWdleCAmJiBpYycsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgVGVzdC5RdWVyeSh7IHE6ICd7XCJ0aXRsZVwiOiB7XCIkcmVnZXhcIjogXCIvXnRlc3RhL1wifX0nLCBpYzogdHJ1ZSwgc2s6IDIgfSkuZXhlYyhmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGVycm9yLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YS5jb3VudCwgMTApO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YS5kYXRhLmxlbmd0aCwgOCk7XHJcbiAgICAgICAgICAgIGFzc2VydC5pc1RydWUoKGRhdGEuZGF0YVswXS5vcmlnICsgJycpLm1hdGNoKC8oWzAtOWEtel17MjR9KS8pICE9IG51bGwpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIGl0KCdmaW5kICYgc29ydCcsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgVGVzdC5RdWVyeSh7IHE6ICd7fScsIHQ6ICdmaW5kJywgczogJ3tcIm1zZ1wiOiAxfScsIGw6IDEgfSkuZXhlYyhmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGVycm9yLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBhc3NlcnQudHlwZU9mKGRhdGEsICdBcnJheScpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YVswXS50aXRsZSwgJ3Rlc3RhJyk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzBdLm1zZywgJ2kjMCcpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YS5sZW5ndGgsIDEpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIGl0KCdleGFjdCcsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgVGVzdC5RdWVyeSh7IHE6ICd7XCJtc2dcIjpcImkjM1wifScgfSkuZXhlYyhmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGVycm9yLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YS5sZW5ndGgsIDEpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZGF0YVswXS5tc2csIFwiaSMzXCIpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIGl0KCdwb3B1bGF0ZScsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgVGVzdC5RdWVyeSh7IHE6ICd7XCJtc2dcIjpcImkjM1wifScsIHA6ICdvcmlnJyB9KS5leGVjKGZ1bmN0aW9uIChlcnJvciwgZGF0YSkge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZXJyb3IsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhLmxlbmd0aCwgMSk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzBdLm1zZywgXCJpIzNcIik7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzBdLm9yaWcudmFsdWUsIFwib3JpZ2luYWxcIik7XHJcbiAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgaXQoJ2xpbWl0ICYgc2VsZWN0JywgZnVuY3Rpb24gKGRvbmUpIHtcclxuICAgICAgICBUZXN0LlF1ZXJ5KHsgcTogJ3t9JywgZjogJ3RpdGxlJywgbDogJzMnLCBzOiAne1widGl0bGVcIjogLTF9JyB9KS5leGVjKGZ1bmN0aW9uIChlcnJvciwgZGF0YSkge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZXJyb3IsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhLmxlbmd0aCwgMyk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzBdLm1zZywgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGRhdGFbMF0udGl0bGUsIFwidGVzdGJcIik7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzFdLm1zZywgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGRhdGFbMV0udGl0bGUsIFwidGVzdGJcIik7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhWzJdLm1zZywgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGRhdGFbMl0udGl0bGUsIFwidGVzdGJcIik7XHJcbiAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdza2lwJywgZnVuY3Rpb24gKGRvbmUpIHtcclxuICAgICAgICBUZXN0LlF1ZXJ5KHsgcTogJ3t9Jywgc2s6ICczJyB9KS5leGVjKGZ1bmN0aW9uIChlcnJvciwgZGF0YSkge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZXJyb3IsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChkYXRhLmxlbmd0aCwgMTcpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY291bnQnLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIFRlc3QuUXVlcnkoeyBxOiAne1wiJG9yXCI6IFsge1wibXNnXCI6XCJpIzFcIn0sIHtcIm1zZ1wiOlwiaSMyXCJ9XX0nLCB0OiAnY291bnQnIH0pLmV4ZWMoZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChlcnJvciwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGRhdGEsIDIpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGlzdGluY3QnLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIFRlc3QuUXVlcnkoeyBmOiAndGl0bGUnLCB0OiAnZGlzdGluY3QnIH0pLmV4ZWMoZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChlcnJvciwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGRhdGEubGVuZ3RoLCAyKTtcclxuXHJcbiAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXX0=
